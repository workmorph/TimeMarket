{"version":3,"file":"timebid-widget.iife.js","sources":["../../src/widget/TimeBidWidget.ts","../../src/widget/index.ts"],"sourcesContent":["/**\n * TimeBidWidget - 外部サイトに埋め込み可能なオークションウィジェット\n */\n\ninterface WidgetConfig {\n  apiKey: string;\n  containerId: string;\n  theme?: {\n    primaryColor?: string;\n    secondaryColor?: string;\n    fontFamily?: string;\n    borderRadius?: string;\n  };\n  baseUrl?: string;\n  onBidPlaced?: (bid: any) => void;\n  onAuctionEnd?: (auction: any) => void;\n  onWidgetLoad?: () => void;\n}\n\ninterface WidgetMessage {\n  type: string;\n  height?: number;\n  bid?: any;\n  auction?: any;\n  error?: string;\n}\n\nexport class TimeBidWidget {\n  private config: WidgetConfig;\n  private iframe: HTMLIFrameElement | null = null;\n  private container: HTMLElement | null = null;\n  private isConnected: boolean = false;\n\n  constructor(config: WidgetConfig) {\n    this.config = {\n      apiKey: config.apiKey,\n      containerId: config.containerId,\n      theme: config.theme || {},\n      baseUrl: config.baseUrl || 'https://api.timebid.com',\n      onBidPlaced: config.onBidPlaced,\n      onAuctionEnd: config.onAuctionEnd,\n      onWidgetLoad: config.onWidgetLoad\n    };\n    this.init();\n  }\n\n  /**\n   * ウィジェットの初期化\n   */\n  private init(): void {\n    try {\n      this.container = document.getElementById(this.config.containerId);\n      if (!this.container) {\n        throw new Error(`Container with ID '${this.config.containerId}' not found`);\n      }\n      \n      this.render();\n      this.setupEventListeners();\n    } catch (error) {\n      console.error('TimeBid Widget initialization error:', error);\n      this.renderError((error as Error).message);\n    }\n  }\n\n  /**\n   * ウィジェットのレンダリング\n   */\n  private render(): void {\n    if (!this.container) return;\n\n    // 既存のコンテンツをクリア\n    this.container.innerHTML = '';\n    \n    // ウィジェットのスタイルを適用\n    this.container.style.position = 'relative';\n    this.container.style.overflow = 'hidden';\n    this.container.style.minHeight = '400px';\n    \n    // ローディングインジケータ\n    const loader = document.createElement('div');\n    loader.style.position = 'absolute';\n    loader.style.top = '0';\n    loader.style.left = '0';\n    loader.style.width = '100%';\n    loader.style.height = '100%';\n    loader.style.display = 'flex';\n    loader.style.alignItems = 'center';\n    loader.style.justifyContent = 'center';\n    loader.style.backgroundColor = '#f9f9f9';\n    loader.style.zIndex = '1';\n    loader.innerHTML = '<div style=\"width: 40px; height: 40px; border: 3px solid #ddd; border-top-color: #3498db; border-radius: 50%; animation: timebid-spin 1s linear infinite;\"></div>';\n    \n    // アニメーションのスタイルを追加\n    const style = document.createElement('style');\n    style.textContent = '@keyframes timebid-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';\n    document.head.appendChild(style);\n    \n    this.container.appendChild(loader);\n    \n    // iframeの作成\n    const iframe = document.createElement('iframe');\n    iframe.src = `${this.config.baseUrl}/widget?key=${this.config.apiKey}&theme=${encodeURIComponent(JSON.stringify(this.config.theme))}`;\n    iframe.style.width = '100%';\n    iframe.style.height = '400px';\n    iframe.style.border = 'none';\n    iframe.style.position = 'relative';\n    iframe.style.zIndex = '2';\n    iframe.style.opacity = '0';\n    iframe.style.transition = 'opacity 0.3s ease';\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups');\n    iframe.setAttribute('title', 'TimeBid Auction Widget');\n    \n    this.container.appendChild(iframe);\n    this.iframe = iframe;\n    \n    // iframeの読み込みが完了したらローディングを非表示\n    iframe.onload = () => {\n      iframe.style.opacity = '1';\n      setTimeout(() => {\n        if (loader.parentNode) {\n          loader.parentNode.removeChild(loader);\n        }\n        this.config.onWidgetLoad?.();\n      }, 300);\n    };\n  }\n\n  /**\n   * イベントリスナーの設定\n   */\n  private setupEventListeners(): void {\n    window.addEventListener('message', this.handleMessage.bind(this));\n  }\n\n  /**\n   * メッセージハンドラー\n   */\n  private handleMessage(event: MessageEvent): void {\n    // オリジン検証\n    if (event.origin !== this.config.baseUrl) return;\n    \n    const data = event.data as WidgetMessage;\n    \n    switch(data.type) {\n      case 'TIMEBID_RESIZE':\n        if (this.iframe && data.height) {\n          this.iframe.style.height = `${data.height}px`;\n        }\n        break;\n      case 'TIMEBID_BID_PLACED':\n        if (data.bid) {\n          this.config.onBidPlaced?.(data.bid);\n        }\n        break;\n      case 'TIMEBID_AUCTION_END':\n        if (data.auction) {\n          this.config.onAuctionEnd?.(data.auction);\n        }\n        break;\n      case 'TIMEBID_CONNECTED':\n        this.isConnected = true;\n        console.log('Widget connected to TimeBid server');\n        break;\n      case 'TIMEBID_ERROR':\n        console.error('TimeBid Widget error:', data.error);\n        break;\n    }\n  }\n\n  /**\n   * エラーメッセージの表示\n   */\n  private renderError(message: string): void {\n    if (!this.container) return;\n    \n    this.container.innerHTML = '';\n    \n    const errorElement = document.createElement('div');\n    errorElement.style.padding = '20px';\n    errorElement.style.color = '#721c24';\n    errorElement.style.backgroundColor = '#f8d7da';\n    errorElement.style.border = '1px solid #f5c6cb';\n    errorElement.style.borderRadius = '4px';\n    errorElement.style.textAlign = 'center';\n    errorElement.innerHTML = `<strong>TimeBid Widget Error:</strong> ${message}`;\n    \n    this.container.appendChild(errorElement);\n  }\n\n  /**\n   * ウィジェットの更新\n   */\n  public refresh(): void {\n    this.init();\n  }\n\n  /**\n   * ウィジェットの接続状態を確認\n   */\n  public isConnectedToServer(): boolean {\n    return this.isConnected;\n  }\n\n  /**\n   * ウィジェットの破棄\n   */\n  public destroy(): void {\n    window.removeEventListener('message', this.handleMessage.bind(this));\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.iframe = null;\n    this.isConnected = false;\n  }\n}\n","import { TimeBidWidget } from './TimeBidWidget';\n\n// グローバルに公開するためのインターフェース\ninterface TimeBidGlobal {\n  createWidget: (config: any) => TimeBidWidget;\n  version: string;\n}\n\n// グローバルオブジェクトの作成\nconst TimeBid: TimeBidGlobal = {\n  createWidget: (config) => new TimeBidWidget(config),\n  version: '1.0.0'\n};\n\n// グローバルスコープに追加\ndeclare global {\n  interface Window {\n    TimeBid: TimeBidGlobal;\n  }\n}\n\n// ブラウザ環境の場合はグローバルに公開\nif (typeof window !== 'undefined') {\n  window.TimeBid = TimeBid;\n}\n\nexport default TimeBid;\nexport { TimeBidWidget };\n"],"names":["TimeBidWidget","constructor","config","this","iframe","container","isConnected","apiKey","containerId","theme","baseUrl","onBidPlaced","onAuctionEnd","onWidgetLoad","init","document","getElementById","Error","render","setupEventListeners","error","console","renderError","message","innerHTML","style","position","overflow","minHeight","loader","createElement","top","left","width","height","display","alignItems","justifyContent","backgroundColor","zIndex","textContent","head","appendChild","src","encodeURIComponent","JSON","stringify","border","opacity","transition","setAttribute","onload","setTimeout","parentNode","removeChild","_b","_a","call","window","addEventListener","handleMessage","bind","event","origin","data","type","bid","auction","_d","_c","log","errorElement","padding","color","borderRadius","textAlign","refresh","isConnectedToServer","destroy","removeEventListener","TimeBid","createWidget","version"],"mappings":"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"}