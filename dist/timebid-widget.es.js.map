{"version":3,"file":"timebid-widget.es.js","sources":["../src/widget/TimeBidWidget.ts","../src/widget/index.ts"],"sourcesContent":["/**\n * TimeBidWidget - 外部サイトに埋め込み可能なオークションウィジェット\n */\n\ninterface WidgetConfig {\n  apiKey: string;\n  containerId: string;\n  theme?: {\n    primaryColor?: string;\n    secondaryColor?: string;\n    fontFamily?: string;\n    borderRadius?: string;\n  };\n  baseUrl?: string;\n  onBidPlaced?: (bid: any) => void;\n  onAuctionEnd?: (auction: any) => void;\n  onWidgetLoad?: () => void;\n}\n\ninterface WidgetMessage {\n  type: string;\n  height?: number;\n  bid?: any;\n  auction?: any;\n  error?: string;\n}\n\nexport class TimeBidWidget {\n  private config: WidgetConfig;\n  private iframe: HTMLIFrameElement | null = null;\n  private container: HTMLElement | null = null;\n  private isConnected: boolean = false;\n\n  constructor(config: WidgetConfig) {\n    this.config = {\n      apiKey: config.apiKey,\n      containerId: config.containerId,\n      theme: config.theme || {},\n      baseUrl: config.baseUrl || 'https://api.timebid.com',\n      onBidPlaced: config.onBidPlaced,\n      onAuctionEnd: config.onAuctionEnd,\n      onWidgetLoad: config.onWidgetLoad\n    };\n    this.init();\n  }\n\n  /**\n   * ウィジェットの初期化\n   */\n  private init(): void {\n    try {\n      this.container = document.getElementById(this.config.containerId);\n      if (!this.container) {\n        throw new Error(`Container with ID '${this.config.containerId}' not found`);\n      }\n      \n      this.render();\n      this.setupEventListeners();\n    } catch (error) {\n      console.error('TimeBid Widget initialization error:', error);\n      this.renderError((error as Error).message);\n    }\n  }\n\n  /**\n   * ウィジェットのレンダリング\n   */\n  private render(): void {\n    if (!this.container) return;\n\n    // 既存のコンテンツをクリア\n    this.container.innerHTML = '';\n    \n    // ウィジェットのスタイルを適用\n    this.container.style.position = 'relative';\n    this.container.style.overflow = 'hidden';\n    this.container.style.minHeight = '400px';\n    \n    // ローディングインジケータ\n    const loader = document.createElement('div');\n    loader.style.position = 'absolute';\n    loader.style.top = '0';\n    loader.style.left = '0';\n    loader.style.width = '100%';\n    loader.style.height = '100%';\n    loader.style.display = 'flex';\n    loader.style.alignItems = 'center';\n    loader.style.justifyContent = 'center';\n    loader.style.backgroundColor = '#f9f9f9';\n    loader.style.zIndex = '1';\n    loader.innerHTML = '<div style=\"width: 40px; height: 40px; border: 3px solid #ddd; border-top-color: #3498db; border-radius: 50%; animation: timebid-spin 1s linear infinite;\"></div>';\n    \n    // アニメーションのスタイルを追加\n    const style = document.createElement('style');\n    style.textContent = '@keyframes timebid-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';\n    document.head.appendChild(style);\n    \n    this.container.appendChild(loader);\n    \n    // iframeの作成\n    const iframe = document.createElement('iframe');\n    iframe.src = `${this.config.baseUrl}/widget?key=${this.config.apiKey}&theme=${encodeURIComponent(JSON.stringify(this.config.theme))}`;\n    iframe.style.width = '100%';\n    iframe.style.height = '400px';\n    iframe.style.border = 'none';\n    iframe.style.position = 'relative';\n    iframe.style.zIndex = '2';\n    iframe.style.opacity = '0';\n    iframe.style.transition = 'opacity 0.3s ease';\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups');\n    iframe.setAttribute('title', 'TimeBid Auction Widget');\n    \n    this.container.appendChild(iframe);\n    this.iframe = iframe;\n    \n    // iframeの読み込みが完了したらローディングを非表示\n    iframe.onload = () => {\n      iframe.style.opacity = '1';\n      setTimeout(() => {\n        if (loader.parentNode) {\n          loader.parentNode.removeChild(loader);\n        }\n        this.config.onWidgetLoad?.();\n      }, 300);\n    };\n  }\n\n  /**\n   * イベントリスナーの設定\n   */\n  private setupEventListeners(): void {\n    window.addEventListener('message', this.handleMessage.bind(this));\n  }\n\n  /**\n   * メッセージハンドラー\n   */\n  private handleMessage(event: MessageEvent): void {\n    // オリジン検証\n    if (event.origin !== this.config.baseUrl) return;\n    \n    const data = event.data as WidgetMessage;\n    \n    switch(data.type) {\n      case 'TIMEBID_RESIZE':\n        if (this.iframe && data.height) {\n          this.iframe.style.height = `${data.height}px`;\n        }\n        break;\n      case 'TIMEBID_BID_PLACED':\n        if (data.bid) {\n          this.config.onBidPlaced?.(data.bid);\n        }\n        break;\n      case 'TIMEBID_AUCTION_END':\n        if (data.auction) {\n          this.config.onAuctionEnd?.(data.auction);\n        }\n        break;\n      case 'TIMEBID_CONNECTED':\n        this.isConnected = true;\n        console.log('Widget connected to TimeBid server');\n        break;\n      case 'TIMEBID_ERROR':\n        console.error('TimeBid Widget error:', data.error);\n        break;\n    }\n  }\n\n  /**\n   * エラーメッセージの表示\n   */\n  private renderError(message: string): void {\n    if (!this.container) return;\n    \n    this.container.innerHTML = '';\n    \n    const errorElement = document.createElement('div');\n    errorElement.style.padding = '20px';\n    errorElement.style.color = '#721c24';\n    errorElement.style.backgroundColor = '#f8d7da';\n    errorElement.style.border = '1px solid #f5c6cb';\n    errorElement.style.borderRadius = '4px';\n    errorElement.style.textAlign = 'center';\n    errorElement.innerHTML = `<strong>TimeBid Widget Error:</strong> ${message}`;\n    \n    this.container.appendChild(errorElement);\n  }\n\n  /**\n   * ウィジェットの更新\n   */\n  public refresh(): void {\n    this.init();\n  }\n\n  /**\n   * ウィジェットの接続状態を確認\n   */\n  public isConnectedToServer(): boolean {\n    return this.isConnected;\n  }\n\n  /**\n   * ウィジェットの破棄\n   */\n  public destroy(): void {\n    window.removeEventListener('message', this.handleMessage.bind(this));\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    this.iframe = null;\n    this.isConnected = false;\n  }\n}\n","import { TimeBidWidget } from './TimeBidWidget';\n\n// グローバルに公開するためのインターフェース\ninterface TimeBidGlobal {\n  createWidget: (config: any) => TimeBidWidget;\n  version: string;\n}\n\n// グローバルオブジェクトの作成\nconst TimeBid: TimeBidGlobal = {\n  createWidget: (config) => new TimeBidWidget(config),\n  version: '1.0.0'\n};\n\n// グローバルスコープに追加\ndeclare global {\n  interface Window {\n    TimeBid: TimeBidGlobal;\n  }\n}\n\n// ブラウザ環境の場合はグローバルに公開\nif (typeof window !== 'undefined') {\n  window.TimeBid = TimeBid;\n}\n\nexport default TimeBid;\nexport { TimeBidWidget };\n"],"names":[],"mappings":"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"}